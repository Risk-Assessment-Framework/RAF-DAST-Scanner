from flask import Flask, jsonify, request
import requests

import os
from dotenv import load_dotenv
load_dotenv()

API_KEY_VIRUSTOTAL = os.getenv('API_KEY_VIRUSTOTAL')

app = Flask(__name__)

# Replace YOUR_API_KEY with your actual VirusTotal API key

SCAN_URL = 'https://www.virustotal.com/vtapi/v2/url/scan'
REPORT_URL = 'https://www.virustotal.com/vtapi/v2/url/report'


# Endpoint for scanning a website for malware
@app.route('/scan', methods=['POST'])
def scan_website():
    url = request.json['url']

    # Send the URL to VirusTotal for scanning
    params = {'apikey': API_KEY_VIRUSTOTAL, 'url': url}
    response = requests.post(SCAN_URL, data=params)

    # Get the scan ID from the response
    scan_id = response.json()['scan_id']

    # Check the report for the scan results
    params = {'apikey': API_KEY_VIRUSTOTAL, 'resource': scan_id}
    response = requests.get(REPORT_URL, params=params)

    # Return the scan results as JSON
    return jsonify(response.json())

if __name__ == '__main__':
    app.run(debug=True)
